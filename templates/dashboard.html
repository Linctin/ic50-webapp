
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藥物敏感性儀表板</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1400px; margin: auto; background-color: #ffffff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #e2eafc; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f1f1f1; }
        .nav { margin-bottom: 20px; }
        .nav a { text-decoration: none; background-color: #007bff; color: white; padding: 10px 20px; border-radius: 5px; margin-right: 10px; }
        .nav a:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="/">IC50 計算器</a>
            <a href="/dashboard">儀表板</a>
        </div>
        <h1>類器官藥物敏感性排名</h1>
        <p>此儀表板根據三種藥物 (5FU, Irinotecan, Oxaliplatin) 的綜合 Z-score 對類器官進行排名。<br><strong>綜合 Z-score 越高，代表抗藥性越強。</strong></p>
        <table id="dashboard-table">
            <thead>
                <tr>
                    <th>Organoid ID</th>
                    <th>IC50 of 5FU (Z-Score)</th>
                    <th>IC50 of Irinotecan (Z-Score)</th>
                    <th>IC50 of Oxaliplatin (Z-Score)</th>
                    <th>Composite Score</th>
                </tr>
            </thead>
            <tbody id="dashboard-tbody">
                <!-- Data will be loaded here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard_data');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const tbody = document.getElementById('dashboard-tbody');
                tbody.innerHTML = ''; // Clear existing data

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">目前沒有數據。請先到計算器頁面提交數據。</td></tr>';
                    return;
                }

                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.organoid_id}</td>
                        <td>${row.ic50_5fu} (${row.z_score_5fu})</td>
                        <td>${row.ic50_irinotecan} (${row.z_score_irinotecan})</td>
                        <td>${row.ic50_oxaliplatin} (${row.z_score_oxaliplatin})</td>
                        <td><strong>${row.composite_score}</strong></td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (error) {
                console.error("無法加載儀表板數據:", error);
                const tbody = document.getElementById('dashboard-tbody');
                tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">加載數據失敗。請檢查後端服務是否正常。</td></tr>`;
            }
        }

        window.onload = loadDashboardData;
    </script>
</body>
</html>
